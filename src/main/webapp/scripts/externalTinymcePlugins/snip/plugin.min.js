/**
 * Snip plugin
 * Author: fran, matthias
 * Date: 23/09/2015
 */

tinymce.PluginManager.add('snip', function (editor, url) {

  var createSnippetButtonOnClick = function () {
    var content = editor.selection.getContent();
    if (content === "") {
      apprise("Please select some content to create a new snippet");
      return;
    }
    editor.execCommand("cmdSnip");
  };

  editor.addCommand('cmdSnip', function () {
    editor.windowManager.openUrl({
      title: 'Create a snippet',
      url: url + '/iframe.html',
      width: 600,
      height: 500,
      buttons: [
        { 
          text: 'Cancel', 
          type: 'cancel'
        },
        { 
          text: 'Create',
          type: 'custom',
          name: 'create',
          primary: true
        }
      ],
      onAction(api, button) {
        if(button.name = 'create') {
          editor.fire('snippet-create');
        }
      }
    });
  });

  // Add a button that opens a window
  editor.ui.registry.addButton('snip', {
    tooltip: 'Create a snippet',
    icon: 'cut',
    onAction: createSnippetButtonOnClick
  });

  // Adds a menu item to the 'Edit' menu
  editor.ui.registry.addMenuItem('optSnip', {
    text: 'Create a snippet',
    icon: 'cut',
    onAction: createSnippetButtonOnClick
  });
});