/**
 * Github plugin Author: karolis Date : 09/10/2016
 */

var gitHubEditor;
var gitHubUrl;

tinymce.PluginManager.add('github', function(editor, url) {

	gitHubEditor = editor;
	gitHubUrl = url;
	
	editor.addCommand('cmdGitHub', function() {
		document.body.style.overflow = "hidden";
		editor.windowManager.openUrl({
			title: 'GitHub Link',
			url: url + '/dialog.htm',
			width: 550,
			height: 460,
			buttons: [
				{ 
					text: 'Cancel', 
					type: 'cancel'
				},
				{ 
					text: 'Insert',
					type: 'custom',
					name: 'insert',
					primary: true
				},
			],
			onAction(dialogApi, details) {
				if(details.name == 'insert') {
					editor.fire('github-insert');
				}
			}
		});
	});

	// Add a button that opens a window
	editor.ui.registry.addButton('github', {
		icon : 'github',
		tooltip : 'Insert from GitHub',
		onAction : function() {
			editor.execCommand("cmdGitHub");
		},
	});

	// Adds a menu item to the insert menu
	editor.ui.registry.addMenuItem('optGitHub', {
		text : 'From GitHub',
		icon : 'github',
		onAction : function() {
			editor.execCommand("cmdGitHub");
		},
	});

  // Adds a menu item to the slash menu
  if(!window.insertActions) window.insertActions = new Map();
  window.insertActions.set("optGitHub", {
    text: 'From GitHub',
    icon: 'github',
    action: () => {
			editor.execCommand("cmdGitHub");
    },
  });

});
