/**
 * Mendeley integration plugin
 */

var mendeleyEditor;
var mendeleyUrl;

tinymce.PluginManager.add('mendeley', function (editor, url) {
	mendeleyEditor = editor;
	MendeleyUrl = url;

	editor.addCommand('cmdMendeley', function () {
		editor.windowManager.openUrl({
			title: 'Mendeley (beta)',
			url: url + '/dialog.htm',
			width: 700,
			height: 500,
			buttons: [
				{ 
					text: 'Cancel', 
					type: 'cancel' 
				},
				{ 
					text: 'Insert',
					type: 'custom',
					name: 'insert',
					primary: true
				}
			],
			onAction(dialogApi, details) {
				if(details.name == 'insert') {
					editor.fire('mendeley-insert');
				}
			}
		});
	});

	editor.ui.registry.addButton('mendeley', {
		icon: 'mendeley',
		tooltip: 'Insert from Mendeley',
		onAction: function () {
			editor.execCommand("cmdMendeley");
		}
	});

	editor.ui.registry.addMenuItem('optMendeley', {
		text: 'From Mendeley',
		icon: 'mendeley',
		onAction: function () {
			editor.execCommand("cmdMendeley");
		},
	});

  if(!window.insertActions) window.insertActions = new Map();
  window.insertActions.set("optMendeley", {
    text: 'From Mendeley',
    icon: 'mendeley',
    action: () => {
      editor.execCommand("cmdMendeley");
    },
  });

});
