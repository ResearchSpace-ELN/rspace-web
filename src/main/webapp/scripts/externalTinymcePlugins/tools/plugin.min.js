/**
 * The plugin defining 'Scientific Tools' and 'Online Tools' menus
 * Author: matthias
 * Date: 14/11/2017
 */
tinymce.PluginManager.add('tools', function (editor, url) {

  editor.addCommand('cmdRSDilutionCalc', function () {
    editor.windowManager.openUrl({
      title: 'Dilution Calculator',
      url: url + '/dilution-calculator.html',
      width: 770,
      height: 400,
      buttons: [
        { 
          text: 'Close',
          type: 'cancel',
        },
        {
          text: 'Insert',
          name: 'insert',
          type: 'custom',
          primary: true
        },
      ],
      onAction: function (api, button) {
        if(button.name === 'insert') {
          editor.fire('dilution-calc-insert');
        }
      }
    });
  });

  editor.addCommand('cmdRSMasterMix', function () {
    editor.windowManager.openUrl({
      title: 'PCR Master Mix',
      url: url + '/master-mix.html',
      width: 770,
      height: 530,
      buttons: [
        { 
          text: 'Close',
          type: 'cancel'
        },
        {
          text: 'Insert',
          type: 'custom',
          name: 'insert',
          primary: true
        },
      ],
      onAction: function(api, button) {
        if(button.name == 'insert') {
          editor.fire('master-mix-insert');
        }
      }
    });
  });

  editor.addCommand('cmdRSTools', function () {
    editor.windowManager.openUrl({
      title: 'RS LabTools',
      url: url + '/rspaceTools.htm',
      width: 620,
      height: 550,
      buttons: [
        { 
          text: 'Close',
          type: 'cancel'
        },
        { 
          text: 'Insert',
          name: 'insert',
          type: 'custom',
          primary: true 
        }
      ],
      onAction: function(api, button) {
        if(button.name === 'insert') {
          editor.fire('rs-lab-tools-insert');
        }
      }
    });
  });

  editor.ui.registry.addMenuItem('optRSpaceTools', {
    text: 'Other tools...',
    onAction: function () {
      RS.trackEvent('LabTools-Other');
      editor.execCommand("cmdRSTools");
    }
  });

  editor.ui.registry.addMenuItem('optDilutionCalc', {
    text: 'Dilution calculator',
    onAction: function () {
      RS.trackEvent('LabTools Dilution');
      editor.execCommand("cmdRSDilutionCalc");
    }
  });

  editor.ui.registry.addMenuItem('optMasterMix', {
    text: 'PCR Master Mix',
    onAction: function () {
      RS.trackEvent('LabTools PCRMasterMix');
      editor.execCommand("cmdRSMasterMix");
    }
  });

  editor.ui.registry.addMenuItem('optOnlineBC', {
    text: 'Buffer Calculator',
    onAction: function (e) {
      RS.trackEvent('LabTools-Ext', { "name": "BufferCalculator" });
      RS.openInNewWindow("https://www.liverpool.ac.uk/pfg/Research/Tools/BuffferCalc/Buffer.html");
    }
  });

  editor.ui.registry.addMenuItem('optOnlineCS', {
    text: 'CalculatorSoup.com',
    onAction: function (e) {
      RS.trackEvent('LabTools-Ext', { "name": "CalculatorSoup" });
      RS.openInNewWindow("https://www.calculatorsoup.com");
    }
  });

  editor.ui.registry.addMenuItem('optOnlinePM', {
    text: 'PubMed Advanced Search',
    onAction: function (e) {
      RS.trackEvent('LabTools-Ext', { "name": "Pubmed" });
      RS.openInNewWindow("https://www.ncbi.nlm.nih.gov/pubmed/advanced");
    }
  });
  editor.ui.registry.addNestedMenuItem('optOnlineSA', {
    text: 'Sigma-Aldrich.com',
    getSubmenuItems: function() {
      return [
          {type: "menuitem", text: "Normality & Molarity calculator", 
              onAction: function () {
                  RS.trackEvent('LabTools-Ext', { "name": "Sigma-Aldrich" });
                  RS.openInNewWindow("https://www.sigmaaldrich.com/chemistry/stockroom-reagents/learning-center/technical-library/molarity-calculator.html");
              }
          }]; } 
  });
  editor.ui.registry.addMenuItem('optOnlineSG', {
    text: 'ScienceGateway.org',
    onAction: function (e) {
      RS.trackEvent('LabTools-Ext', { "name": "ScienceGateway" });
      RS.openInNewWindow("http://sciencegateway.org/tools/index.html");
    }
  });
});
