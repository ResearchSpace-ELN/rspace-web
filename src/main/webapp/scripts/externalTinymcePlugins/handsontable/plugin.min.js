/**
 * Handsontable plugin for tinyMCE. 
 *
 * Author: Matthias
 * Date : 05/09/2017
 */

tinymce.PluginManager.add('handsontable', function (editor, url) {

	editor.addCommand('cmdHandsontable', function () {
		editor.windowManager.openUrl({
			title: 'Calculations Table',
			url: url + '/dialog.html',
			width: 650,
			height: 400,
			buttons: [
				{ 
					text: 'Cancel',
					type: 'custom',
					name: 'cancel'
				},
				{ 
					text: 'Insert',
					type: 'custom',
					primary: true,
					name: 'insert'
				}
			],
			onAction: function (dialogApi, details) {
				if(details.name === 'cancel') {
					editor.execCommand("cmdConfirmCancel");
				} else if(details.name == 'insert') {
					insertHandsontable(editor);
				}
			}
		});
	});

	editor.ui.registry.addButton('handsontable', {
		tooltip: 'Insert Calculations Table',
		icon: 'table',
		onAction: function () { editor.execCommand("cmdHandsontable"); },
	});

	editor.ui.registry.addMenuItem('optHandsontable', {
		text: 'Insert Calculations Table',
		icon: 'table',
		onAction: function () { editor.execCommand("cmdHandsontable"); },
	});
});

function insertHandsontable(ed) {
	ed.handsonDialog.insert(ed);
}