/**
 * MathJax plugin
 * Author: matthias
 * Date: 12/04/2017
 */
tinymce.PluginManager.add('mathjax', function(editor, url) {
	editor.addCommand('cmdRsMathJax', function(){		
		editor.windowManager.openUrl({
			title: 'Equation Editor',
			url: url + '/dialog.html',
			width: 620,
			height: 460,
			buttons: [
				{ 
					text: 'Cancel', 
					type: 'custom',
					name: 'cancel'
				},
				{ 
					text: 'Insert',
					type: 'custom',
					name: 'insert',
					primary: true
				}
			],
      onAction: (dialogApi, details) => {
        if (details.name === 'cancel') {
          editor.execCommand("cmdConfirmCancel");
        } else if (details.name === 'insert') {
					insertMathJaxImg(editor, url);
				}
      }
		});
	});
		
	// add a button to the menu bar once the icon loads
	editor.ui.registry.addButton('btnMathjax', {
		icon: "equation",
		tooltip: 'Insert equation',
		onAction: function() { editor.execCommand("cmdRsMathJax"); },
		stateSelector: 'div.rsEquation'
	});

	editor.ui.registry.addMenuItem('optMathjax', {
		text: 'Equation',
		icon : "equation",		
		onAction: function() { editor.execCommand("cmdRsMathJax"); },
	});

  if(!window.insertActions) window.insertActions = new Map();
  window.insertActions.set("optMathjax", {
    text: 'Equation',
    icon: 'equation',
    action: () => {
      editor.execCommand('cmdRsMathJax');
    },
  });
});

function insertMathJaxImg(ed, url){
	ed.mathjaxDialog.insert(ed);	
}
