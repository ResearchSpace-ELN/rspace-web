/**
 * Egnyte plugin. Two versions, based on:
 * 1) https://github.com/egnyte/egnyte-js-sdk/blob/master/src/docs/widgets.md
 * 2) https://github.com/egnyte/for-integrators/blob/master/doc/FPaaS.md
 * 
 * Author: Matthias
 * Date : 10/08/2017
 */

tinymce.PluginManager.add('egnyte', function (editor, url) {

	editor.addCommand('cmdEgnyte', function () {
		editor.windowManager.openUrl({
			title: 'Egnyte File Picker',
			url: url + '/dialog.html',
			width: 620,
			height: 500
		});
	});

	editor.ui.registry.addButton('egnyte', {
		tooltip: 'Insert from Egnyte',
		icon: 'egnyte',
		onAction: function () { editor.execCommand("cmdEgnyte") },
	});

	editor.ui.registry.addMenuItem('optEgnyte', {
		text: 'From Egnyte',
		icon: 'egnyte',
		onAction: function () { editor.execCommand("cmdEgnyte") },
	});

  if(!window.insertActions) window.insertActions = new Map();
  window.insertActions.set("optEgnyte", {
    text: 'From Egnyte',
    icon: 'egnyte',
    action: () => {
			editor.execCommand("cmdEgnyte");
    },
  });

	document.addEventListener('egnyte-insert', function (e) {
		RS.insertTemplateIntoTinyMCE('insertedExternalDocumentTemplate', e.detail, editor);
	});
});
